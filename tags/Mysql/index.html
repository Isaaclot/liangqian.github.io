<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Mysql | 哈姆雷特1001</title>
  <meta name="author" content="Rico Nut">
  
  <meta name="description" content="学习总结 思考感悟 知识管理">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="哈姆雷特1001"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/cerulean.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight-default.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/comment.css" media="screen" type="text/css">
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-sham.min.js"></script>
  <![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  
  <!-- analytics -->
  



</head>

<body>
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">哈姆雷特1001</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
    <div class="content">
      

<!-- title -->
<div class="page-header page-header-inverse ">
  <h1 class="archive-title-tag title title-inverse ">Mysql</h1>
</div>

<div class="row page">
  <!-- cols -->
  
  <div class="col-md-9">
	

	  <div id="top_search"></div>

      
         <!-- display as entry -->
	     <div class="mypage">
	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2018-12-01 </div>
			<div class="article-title"><a href="/archives/3eac123.html" title="当一个系统访问量上来的时候，不只是数据库性能瓶颈问题了，数据库数据安全也会浮现，这时候合理使用数据库锁机制就显得异常重要了。">数据库锁机制分类</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<h5 id="按照封锁类型分类"><a href="#按照封锁类型分类" class="headerlink" title="按照封锁类型分类"></a>按照封锁类型分类</h5><ul>
<li>排他锁(<code>X锁</code>)：又称为写锁；如果当前事务获得X锁，会阻塞其他事务的读与写，当前事务释放当前对象的X锁之前，其他事务不能对当前对象进行读或者写；</li>
<li>共享锁(<code>S锁</code>)：又称为读锁；如果当前事务获得了S锁，其他事务只能再对当前对象加S锁，而不能加X锁，保证其他事务可以读当前对象，不可用对当前对象作出更改</li>
</ul>
<h5 id="按照锁的封锁类型分类"><a href="#按照锁的封锁类型分类" class="headerlink" title="按照锁的封锁类型分类"></a>按照锁的封锁类型分类</h5><ul>
<li>行级锁(<code>MySql InnoDb</code>支持)<ol>
<li>优点：锁定粒度小(最小), 发生锁冲突的几率最低，并发度也最高；</li>
<li>缺点：获取锁与释放锁需要的开销比较大；会出现死锁；如果大部分数据操作涉及到<code>order by</code>或者全表扫描的情景，效率明显比其他锁要慢</li>
</ol>
</li>
<li>表级锁<ol>
<li>优点：开销小，加锁与释放锁效率高</li>
<li>缺点：锁定粒度大，发生锁冲突的概率高，并发度低。</li>
</ol>
</li>
<li>页级锁(<code>MySql</code>特有)<ol>
<li>优点：锁定粒度处于两个极端(行级锁与表级锁)之间；所以并发处理能力也处于上面两者之间</li>
<li>缺点：页级锁定和行级锁定一样，会发生死锁</li>
</ol>
</li>
<li>什么时候使用表级锁？<ul>
<li>对于InnoDB，大多数情况下都是选择使用行级锁；因为行级锁和事务支持是我们选择使用InnoDB的理由；</li>
<li>但是，也存在特殊情况：<ol>
<li>事务需要更新大部分或者全部数据，表又比较大，如果使用默认的行锁，处理每条数据都需要进行加锁和释放锁的操作，导致开销非常大，事务执行效率底下；也可能导致其他事务长时间等待或锁冲突；这种情况适合采用锁表来提高事务的执行效率；</li>
<li>事务操作设计到的表比较多，并且复杂，容易引起死锁，或者可能造成大量事务回滚。这样情况也可以考虑使用表锁进行数据库性能上的优化；</li>
</ol>
</li>
</ul>
</li>
</ul>
<h5 id="按照锁的使用方式划分"><a href="#按照锁的使用方式划分" class="headerlink" title="按照锁的使用方式划分"></a>按照锁的使用方式划分</h5><ul>
<li>悲观锁<ol>
<li>悲观并发锁(<code>PCC</code>)：总是假设最坏的情况，每次去操作数据的时候，都认为别人会进行修改，所以每次操作数据的时候都会上锁，这样别人想操作这个数据的时候，就会阻塞，知道锁被释放；共享资源每次只给一个线程\事务使用，其他线程阻塞，锁被释放才会转让操作权</li>
<li>使用场景：适用于多写情景下；避免数据冲突导致的数据不一致的问题</li>
</ol>
</li>
<li>乐观锁<ol>
<li>乐观并发锁：总是假设最好的情况，每次去拿数据的时候都认为别人不会修改，不会加锁； 但是再更新到时候，都会判断一下在此期间别人有木有更新这个数据，这个检查的实现可以是通过版本号机制和CAS算法实现</li>
<li>使用场景：适用于多读情景下；数据冲突发生少，可以省去锁开销</li>
</ol>
</li>
</ul>

	
	</div>
  <a type="button" href="/archives/3eac123.html#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-10-09 </div>
			<div class="article-title"><a href="/archives/8bdd2473.html" title="SQL预编译是指数据库驱动在发送sql语句和参数给DBMS之前对SQL语句进行编译">JDBC SQL预编译</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<h2 id="JDBC-SQL预编译"><a href="#JDBC-SQL预编译" class="headerlink" title="JDBC SQL预编译"></a>JDBC SQL预编译</h2><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><ul>
<li>SQL预编译是指数据库驱动在发送sql语句和参数给DBMS之前对SQL语句进行编译，这样DBMS在执行SQL时，就不需要重新编译。<h4 id="为什么要预编译？"><a href="#为什么要预编译？" class="headerlink" title="为什么要预编译？"></a>为什么要预编译？</h4></li>
<li>JDBC使用<code>PreparedStatement</code>对象来进行预编译语句<ol>
<li>预编译可以优化sql的执行：预编译之后的sql多数情况下可以直接执行，DBMS不需要再次编译；对于越复杂的SQL，编译的成本和复杂度就越高，而预编译可以将多次重复操作，合并多次操作为一次操作</li>
<li>预编译语句可以重复利用：把SQL预编译之后的对象(PreparedStatement )缓存下来，下次对于同一个sql，直接可以使用这个缓存的对象执行，不需要重复</li>
</ol>
</li>
</ul>

	
	</div>
  <a type="button" href="/archives/8bdd2473.html#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-06-16 </div>
			<div class="article-title"><a href="/archives/466fafff.html" title="关联连接查询在多表操作中，用处很多，也很好用，特别是很多关联表一起处理的时候，结构很清晰。">mysql连接查询</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<h3 id="连接的分类-功能性分类"><a href="#连接的分类-功能性分类" class="headerlink" title="连接的分类(功能性分类)"></a>连接的分类(功能性分类)</h3><ul>
<li>左连接：获取左表所有记录，如果右表没有匹配的数据，用null填充至与左表记录数持平；</li>
<li>右连接：获取右表所有记录，数据量以右表为主，填充方法与左连接相同；</li>
<li>内连接：获取两表中满足匹配关系的关联记录，不包括不存在的数据</li>
</ul>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><ul>
<li><code>select * from tableA left(right/inner) join tableB on tableA.ID compopr tableB.ID;</code></li>
<li>说明：tableA/B 是两联合查询的表；compopr 是比较运算符(=,&gt;,&lt;,&gt;=,&lt;=,&lt;&gt;)</li>
</ul>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><h5 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h5><ul>
<li>两个数据表，表中有能管理数据的字段值，并且两表数据量不一致。</li>
<li><p>创建表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE a (aID int( 1 ) AUTO_INCREMENT PRIMARY KEY , aNum char( 20 ))</span><br><span class="line">CREATE TABLE b(bID int( 1 ) NOT NULL AUTO_INCREMENT PRIMARY KEY ,bName char( 20 ))</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据准备：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO a VALUES ( 1, &apos;a20050111&apos; ) , ( 2, &apos;a20050112&apos; ) , ( 3, &apos;a20050113&apos; ) , ( 4, &apos;a20050114&apos; ) , ( 5, &apos;a20050115&apos; ) ;</span><br><span class="line">INSERT INTO b VALUES ( 1, &apos; 2006032401&apos; ) , ( 2, &apos;2006032402&apos; ) , ( 3, &apos;2006032403&apos; ) , ( 4, &apos;2006032404&apos; ) , ( 8, &apos;2006032408&apos; )</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="查询实验"><a href="#查询实验" class="headerlink" title="查询实验"></a>查询实验</h5><ol start="5">
<li>左连接：<code>select * from a  left join b on a.aID=b.bID;</code>,查询结果如下；left join是以A表的记录为基础的,A可以看成左表,B可以看成右表,left join是以左表为准的.<center><img src="http://qvm.lays3721.top/l.png" alt="左连接查询结果"></center></li>
<li>右连接：<code>select * from a right join b on a.aID=b.bID;</code>,查询结果如下；和left join的结果刚好相反,这次是以右表(B)为基础的,A表不足的地方用NULL填充.<center><img src="http://qvm.lays3721.top/r.png" alt="右连接查询结果"><br></center></li>
<li>内连接(相等连接)：<code>select * from a inner join b on a.aID=b.bID;</code>；从查询结果可以看出，检索见过中只有满足匹配条件的数据，不满足的数据不会出现在结果中<center><img src="http://qvm.lays3721.top/i.png" alt="内连接查询结果"></center>

</li>
</ol>
<h3 id="用法拓展"><a href="#用法拓展" class="headerlink" title="用法拓展"></a>用法拓展</h3><ul>
<li>联合连接查询的时候，还可以增加where条件筛选语句，帮助更加精确查询定位数据</li>
</ul>

	
	</div>
  <a type="button" href="/archives/466fafff.html#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-09-17 </div>
			<div class="article-title"><a href="/archives/971c3dff.html" >&#39;Mysql多表操作以及其实例&#39;</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<h2 id="Mysql多表操作及其实例"><a href="#Mysql多表操作及其实例" class="headerlink" title="Mysql多表操作及其实例"></a>Mysql多表操作及其实例</h2><h4 id="数据表："><a href="#数据表：" class="headerlink" title="数据表："></a>数据表：</h4><ul>
<li><p>学生表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------+-------------+------+-----+---------+----------------+</span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra          |</span><br><span class="line">+---------+-------------+------+-----+---------+----------------+</span><br><span class="line">| stuId   | int(11)     | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| classId | int(11)     | YES  |     | NULL    |                |</span><br><span class="line">| stuName | varchar(10) | YES  |     | NULL    |                |</span><br><span class="line">+---------+-------------+------+-----+---------+----------------+</span><br><span class="line">3 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>成绩表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc score;</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">| classId | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| stuId   | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| course  | varchar(10) | YES  |     | NULL    |       |</span><br><span class="line">| score   | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>班级表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc class;</span><br><span class="line">+-----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| Field     | Type        | Null | Key | Default | Extra          |</span><br><span class="line">+-----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| classId   | int(11)     | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| className | varchar(20) | YES  |     | NULL    |                |</span><br><span class="line">+-----------+-------------+------+-----+---------+----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="数据库操作用例"><a href="#数据库操作用例" class="headerlink" title="数据库操作用例"></a>数据库操作用例</h4><ol>
<li><p>查询“语文”课程比“数学”课程成绩高的所有学生的学号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from (select stuId,score from score where course=&apos;语文&apos; ) a,</span><br><span class="line">(select stuId,score from score where course=&apos;数学&apos;) b,(select * from student) c</span><br><span class="line"> where a.stuId=b.stuId and a.score&gt;b.score and a.stuId=c.stuId;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询平均成绩大于60分的同学的学号和平均成绩</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select stuId,avg(score) from score group by stuId having avg(score)&gt;60;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询所有同学的学号、姓名、选课数和平均成绩</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select student.stuId,student.stuName as &apos;姓名&apos;,count(score.classId),sum(score.score) as &apos;所选课程总分&apos;</span><br><span class="line">from student left join score on student.stuId=score.stuId group by student.stuId</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询所有姓’雷’的学生个数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(student.stuName) from student where stuName like &apos;雷%&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询所有课程成绩小于60分的同学的学号，姓名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select student.stuId,student.stuName from student where stuId not in</span><br><span class="line"> (select score.stuId from score where score.score&gt;85)</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询各科的最高分的学生的学号，姓名等信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT *,max(score) as max FROM info.score,info.student</span><br><span class="line">where student.stuId=score.stuId group by score.course;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询各班的第一名学生的信息，按照班级排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT *,max(score) as max FROM info.score,info.student ,info.class</span><br><span class="line">where student.stuId=score.stuId and student.classId=class.classId group by class.classId order by class.className;</span><br></pre></td></tr></table></figure>
</li>
</ol>

	
	</div>
  <a type="button" href="/archives/971c3dff.html#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-08-16 </div>
			<div class="article-title"><a href="/archives/861d9c25.html" >原生JDBC操作数据库的思考总结</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ul>
<li>相信很多java工程师在入门Java操作数据库的时候，都是首先接触到JDBC连接数据库的方式访问操作数据库，对数据库进行增删查改(CRUD)</li>
<li>但是久而久之，基于各种原因(团队\需求)，后来就使用封装了JDBC的框架来访问数据库，比如<code>hibernate</code>,<code>Mybatis\iBats</code>,我这里总结一下一些关于使用原生JDBC操作数据库的一些思考</li>
</ul>
<h4 id="JDBC编程步骤"><a href="#JDBC编程步骤" class="headerlink" title="JDBC编程步骤"></a>JDBC编程步骤</h4><ol>
<li>加载数据库驱动</li>
<li>创建并获取数据库链接</li>
<li>创建jdbc statement对象</li>
<li>设置sql语句</li>
<li>社会sql语句中的参数(使用preparedStatement预加载)</li>
<li>通过statement执行sql并获得结果</li>
<li>对sql执行结果进行解析</li>
<li>释放资源关闭数据库</li>
</ol>
<h4 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h4><ol>
<li>数据库链接，使用时就创建，不使用的时候就释放，对数据库进行频繁连接开启和关闭，造成数据库资源浪费，影响数据库性能<br>假想方案：使用数据库连接池管理数据库连接</li>
<li>将sql语句英编码到Java代码中，如果要修改sql语句，需要重新编译Java代码，不利于系统维护<br>假想方案：将sql语句配置在xml配置文件中，需要修改sql语句的时候直接在xml配置文件，不需要重新编译Java代码</li>
<li>向preparedStatement中设置参数，对占位符位置和设置参数值，硬编码到Java代码中，不利于系统维护<br>假想方案：将sql语句以及占位符和参数全在配置文件中定义配置</li>
<li>从resultSet中遍历结果集数据时，存在硬编码，将获取表的字段进行硬编码，不利于系统维护<br>假想方案：将查询的结果集，自动映射成Java对象</li>
<li>对于繁杂程度来说，要使用一堆编码，才能实现一丢丢的查询……</li>
</ol>

	
	</div>
  <a type="button" href="/archives/861d9c25.html#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-07-26 </div>
			<div class="article-title"><a href="/archives/69b20980.html" title="视图是存储在数据库中的查询的SQL 语句，它主要出于两种原因：安全原因， 视图可以隐藏一些数据，如：社会保险基金表，可以用视图只显示姓名，地址，而不显示社会保险号和工资数等，另一原因是可使复杂的查询易于理解和使用。这个视图就像一个“窗口”，从中只能看到你想看的数据列">Mysql视图技术原理与应用</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<h3 id="视图概述"><a href="#视图概述" class="headerlink" title="视图概述"></a>视图概述</h3><ul>
<li>定义：视图是一个虚拟表，其内容由查询定义，视图表内存在行列数据，但是不在数据库中以存储的数据值集形式存在，行和列数据来自由定义视图的查询所引用的表，并且在引用视图时动态生成.</li>
<li>更新过程：当查询视图时，数据库从相应的引用表中引入数据到视图表</li>
<li>视图技术优点：<ul>
<li>视图能简化用户操作：视图机制使用户可以将注意力集中在所关心的数据上，使数据库看起来结构简单，清晰，并简化用户的查询操作</li>
<li>视图使用户能以多种身份看待数据：灵活地实现多种不同类型的用户共享同一个数据库</li>
<li>视图对重构数据库提供了不同程度上的逻辑独立性：重构时(数据库逻辑改变)，新增关系表或者对原有关系增加新字段，不会影响应用程序所需的数据查询形式</li>
<li>适当的利用视图可以更清晰地表达查询</li>
</ul>
</li>
</ul>
<h3 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例:"></a>使用案例:</h3><h4 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h4><ul>
<li><code>ALGORITHM</code>:定义查询算法<ul>
<li><code>MERGE</code>:将查询视图的语句与视图的定义语句合并处理</li>
<li><code>TEMPTABLE</code>:视图查询的结果保存到临时表，而后在该临时表基础上执行查询视图的语句</li>
<li><code>UNDEFINED</code> : 由Mysql选择使用的算法，一般首选MERGE，因为MERGE更有效率，而且TEMPTABLE不支持更新</li>
</ul>
</li>
<li>WITH[CASCADED|LOCAL] CHECK OPTION 解析<ul>
<li>LOCAL参数表示更新视图时只要满足该视图本身定义的条件即可</li>
<li>CASCADED参数表示更新视图时需要满足所有相关视图和表的条件;没有指明时，该参数为默认值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE [OR REPLACE] [ALGORITHM = &#123;UNDEFINED | MERGE | TEMPTABLE&#125;] VIEW [db_name.]view_name [(column_list)] AS select_statement [WITH [CASCADED | LOCAL] CHECK OPTION]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="创建视图："><a href="#创建视图：" class="headerlink" title="创建视图："></a>创建视图：</h4><ul>
<li>在单表上创建：<code>create view vName(id,sex,age) as select id,sex,age from student;</code></li>
<li>在多表上创建：<code>CREATE VIEW VName(ID, NAME, SEX, AGE,DEPARTMENT,POS,EXPERENCE) AS SELECT a.ID, a.NAME, a.SEX, a.AGE,a.DEPARTMENT,b.POS,b.EXPERENCE FROM learning.t_employee a,learning.t_employee_detail b WHERE a.ID=b.ID;</code></li>
<li>查看视图：<code>DESCRIBE vName;</code>或<code>SHOW TABLE STATUS;</code>或<code>SHOW CREATE VIEW VnAME;</code></li>
<li>修改视图：<ul>
<li><code>create or replace</code> 指令：<code>CREATE OR REPLACE VIEW V_VIEW1(ID, NAME, SEX) AS SELECT ID, NAME, SEX  FROM learning.t_employee;</code></li>
<li><code>ALERT</code>指令: <code>ALTER VIEW  V_VIEW1(ID, NAME) AS SELECT ID, NAME  FROM learning.t_employee;</code></li>
</ul>
</li>
<li>更新视图：主要通过(insert,update,delete)操作表中数据；由于视图上的数据来自于基本表，更新视图虚拟表上的数据都会转换到基本表更新.<ul>
<li>更新视图时，只能更新权限范围内的数据，超出范围，不能更新</li>
<li>指令实例：<code>update vName set project=&quot;psychonologic&quot; where id = 2;</code></li>
<li>不可更新的视图：由于虚拟表对应实体表中的数据，所以不是所有的视图表都能更新；如果视图含有下列结构中的任何一种，则不能更新：<ul>
<li>聚合函数(SUM(),MIN(),MAX(),COUNT()…)</li>
<li>DISTINCT</li>
<li>GROUP BY</li>
<li>HAVING</li>
<li>UNION/UNION ALL</li>
<li>位于选择序列中的子查询</li>
<li>Jion</li>
<li>FROM字句中的不可更新视图</li>
<li>WHERE子句的子查询，引用FROM字句的表</li>
<li>仅引用文字值</li>
<li>ALGORITHM = TEMPTABLE</li>
</ul>
</li>
<li>对于更新操作的提醒：视图虽然可以更新数据，但是有很多限制，一般情况下，最好将视图作为查询数据的虚拟表，而不要通过视图更新数据. 对于一些结构更加复杂的数据库表，最好在实体表中更新数据</li>
</ul>
</li>
</ul>

	
	</div>
  <a type="button" href="/archives/69b20980.html#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-07-25 </div>
			<div class="article-title"><a href="/archives/64423a64.html" title="触发器可以用于记录对数据库的操作，它是一种与表操作有关的数据库对象，当触发器所在表上出现某个触发事件以及触发事件时，将调用该对象。即表的操作事件触发表上的触发器的执行">mysql触发器学与用</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<h3 id="简述："><a href="#简述：" class="headerlink" title="简述："></a>简述：</h3><ul>
<li>Mysql在5.0.2版本以上开始支持触发器，触发器是有某些带有命令的的时间来出发某些操作，这些事件操作包括 insert delete update…</li>
<li>触发器可以用于记录对数据库的操作，它是一种与表操作有关的数据库对象，当触发器所在表上出现某个触发事件以及触发事件时，将调用该对象。即表的操作事件触发表上的触发器的执行</li>
</ul>
<h3 id="创建触发器"><a href="#创建触发器" class="headerlink" title="创建触发器"></a>创建触发器</h3><ul>
<li><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CRATE TRIGGER TRIGGER_NAME </span><br><span class="line">TRIGGER_TIME</span><br><span class="line">TRIGGER_EVENT ON TRIGGER_TABLE</span><br><span class="line">FOR EACH ROW</span><br><span class="line">TRIGGER_STATEMEMTS</span><br></pre></td></tr></table></figure>
</li>
<li><p>解析：</p>
<ul>
<li>TRIGGER_NAME : 表示触发器名称，用户自定义</li>
<li>TRIGGER_TIME :  标识触发时机，取值为：before 、 after </li>
<li>TRIGGER_EVENT : 标识触发事件，取值为：INSERT , UPDATE ,DELETE</li>
<li>TRIGGER_TABLE ：标识建立触发器的表名，也就是触发器的表对象</li>
<li>TRIGGER_STATEMENT：触发器程序体，可以是一条语句，或如果是多条语句，用<code>begin [stmt_list] end;</code>包含，但是每条语句之间用分好分隔</li>
<li>根据触发时机与触发事件的组合，可以看出，最多可以建立6种触发器(注：一个表上不能简历相同的触发器)</li>
</ul>
</li>
<li>对于<code>begin...end</code>，由于中间使用了分号(mysql中标记执行完语句的符号)而导致begin找不到与之匹配的end，因此引入了<code>DELIMITER</code>命令，作为定界分隔符；<code>end$ DELIMITER ;</code></li>
</ul>
<h3 id="一个完整的触发器示例"><a href="#一个完整的触发器示例" class="headerlink" title="一个完整的触发器示例"></a>一个完整的触发器示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">create trigger tri_stuInsert after insert</span><br><span class="line">on student for each row</span><br><span class="line">begin</span><br><span class="line">declare c int;</span><br><span class="line">set c = (select stuCount from class where classID=new.classID);</span><br><span class="line">update class set stuCount = c + 1 where classID = new.classID;</span><br><span class="line">end $</span><br><span class="line">DELIMITER;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>mysql用使用DECLARE 来定义局部变量，并且该遍历只能在BEGIN…END之间使用，并且只能放在期间复合语句的开头</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">格式：DECLARE var_name[,...] type [DEFAULT value]</span><br></pre></td></tr></table></figure>
</li>
<li><p>new与old：</p>
<ul>
<li>INSERT型触发器 ：NEW表示将要(BEFORE)或已经(AFTER)插入的新数据</li>
<li>UPDATE型触发器：OLD用来表示将要或者已经被修改的原数据，NEW表示将要或者已经被修改的新数据</li>
<li>DELETE型触发器：OLD用来表示将要或已经被删除的数据</li>
<li>并且，OLD是只读的，而NEW可以在触发器中使用set赋值，避免二次触发触发器，造成循环调用</li>
</ul>
</li>
</ul>
<h3 id="查看触发器"><a href="#查看触发器" class="headerlink" title="查看触发器"></a>查看触发器</h3><ul>
<li>语法：可以在后面指定数据库名来查看触发器<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show triggers [from scheme_name];</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h3><ul>
<li>语法：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop trigger [if exists] trigger_name;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="触发器执行顺序"><a href="#触发器执行顺序" class="headerlink" title="触发器执行顺序"></a>触发器执行顺序</h3><ul>
<li>我们建立的数据库一般都是 InnoDB 数据库，其上建立的表是事务性表，也就是事务安全的。这时，若SQL语句或触发器执行失败，MySQL 会回滚事务，有：</li>
</ul>
<ol>
<li>如果 BEFORE 触发器执行失败，SQL 无法正确执行</li>
<li>SQL 执行失败时，AFTER 型触发器不会触发</li>
<li>AFTER 类型的触发器执行失败，SQL 会回滚</li>
</ol>

	
	</div>
  <a type="button" href="/archives/64423a64.html#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-06-08 </div>
			<div class="article-title"><a href="/archives/8314bbf6.html" >Mysql管理用户操作(创建用户，删除用户，修改用户密码，权限分配以及相关授权)</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<h4 id="创建mysql用户"><a href="#创建mysql用户" class="headerlink" title="创建mysql用户"></a>创建mysql用户</h4><ul>
<li>创建用户设定密码：<br><code>create user &#39;username&#39; identified by &#39;password&#39;;</code></li>
<li>创建用户，密码，并绑定登陆IP(ip:%表示所有IP，也可以限制为网段[231.23.2.%])<br><code>create user &#39;username&#39;@&#39;ip&#39; identified by &#39;password&#39;</code></li>
<li>使操作生效：<code>flush privileges</code></li>
</ul>
<h4 id="为用户授权"><a href="#为用户授权" class="headerlink" title="为用户授权"></a>为用户授权</h4><ul>
<li>将用户所有的权限绑定到某个数据库：<br><code>grant all privileges on basename(*).tablename(*) to username@localhost</code></li>
<li>或者只授予用户指定的权限：<code>insert</code> <code>delete</code> <code>update</code> <code>select</code>…<br><code>grant insert,select,update,delete on *.* to user@localhost</code></li>
</ul>
<h4 id="撤销用户权限"><a href="#撤销用户权限" class="headerlink" title="撤销用户权限"></a>撤销用户权限</h4><ul>
<li>格式：<code>revoke 权限 on 库名.表名 from 用户名@用户地址;</code></li>
</ul>
<h4 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h4><ul>
<li><p>直接删除用户：<code>drop user</code>(将用户信息全部删除)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;drop user test1@&apos;%&apos;;</span><br><span class="line">&gt;flush privileges;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除用户：<code>delete from user</code>(只会清除对应user创建的表)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;use mysql;</span><br><span class="line">&gt;delete from user where user=test1 and host=&apos;%&apos;;</span><br><span class="line">&gt;flush privileges;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="修改指定用户的密码-也就是更新mysql库下user的表"><a href="#修改指定用户的密码-也就是更新mysql库下user的表" class="headerlink" title="修改指定用户的密码(也就是更新mysql库下user的表)"></a>修改指定用户的密码(也就是更新mysql库下user的表)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;update mysql.user set password=password(&apos;新密码&apos;) where  user=&quot;test2&quot; and host=&quot;%&quot;;</span><br><span class="line">&gt;&gt;flush privilieges;</span><br></pre></td></tr></table></figure>
<h4 id="远程登陆"><a href="#远程登陆" class="headerlink" title="远程登陆"></a>远程登陆</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;mysql -h &apos;ip&apos; -u &apos;username&apos; -p &apos;ip&apos;  ##个人习惯enter之后输密文password</span><br></pre></td></tr></table></figure>
<h4 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h4><ul>
<li>mysql库下面有几个表，研究清楚了，也就更加了解了mysql的基本操作了</li>
<li>还有就是，新版本的mysql数据库自动为你创建了几个常用的库跟表，比如’country’等….(然而我很少用)</li>
</ul>

	
	</div>
  <a type="button" href="/archives/8314bbf6.html#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-05-10 </div>
			<div class="article-title"><a href="/archives/b4e8978.html" >无法连接远程Mysql数据库的解决办法 I</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<h2 id="tips-“Can-not-connet-to-mysql-server-on-‘192-168-2-3’-10061-”"><a href="#tips-“Can-not-connet-to-mysql-server-on-‘192-168-2-3’-10061-”" class="headerlink" title="tips: “Can not connet to mysql  server on ‘192.168.2.3’ (10061)”"></a>tips: “Can not connet to mysql  server on ‘192.168.2.3’ (10061)”</h2><ul>
<li><p>很多时候想要远程登陆Mysql服务器，进行操作，发现弹出上面的提示…</p>
<h2 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h2><ul>
<li>可能没有启动Mysql服务：<code>/etc/init.d/mysql start</code> 启动服务</li>
<li><p>查看配置文件 <code>/etc/mysql/my.cnf</code> 文件中绑定的ip地址是否为默认ip(127.0.0.1)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu: vim /etc/mysql/my.cnf</span><br><span class="line">root@ubuntu:                      #修改my.cnf的文件里面的配置</span><br><span class="line">修改 bind-adress = 127.0.0.1</span><br><span class="line">为 bind-adress = 服务器IP</span><br><span class="line">#这种情况最显著的现象是：远程登陆不上Mysql服务器，但是服务器本地能登陆进去mysql程序</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查或者重置my.ini配置文件是否正确</p>
</li>
<li>Mysql服务器连接池已满，重新释放一下连接池，这时候你要重新评估你的连接数或者检测是否有恶意访问攻击什么的</li>
</ul>
</li>
</ul>
<hr>
<p>  如果找partner，要物色好可靠的人选；不然，两人的价值观不一样，做事情的效率跟质量都不一样。</p>

	
	</div>
  <a type="button" href="/archives/b4e8978.html#more" class="btn btn-default more">阅读此文</a>
</div>

	       
	     </div>
	     <div>
	       <center>
	         <div class="pagination">
<ul class="pagination">
	 
</ul>
</div>

	       </center>
	     </div>	
      

</div> <!-- col-md-9/col-md-12 -->


<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			<div class="widget">
    
</div>

		
			
		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/Java/">Java<span>32</span></a></li>
		
			<li><a href="/tags/Angular-JS/">Angular JS<span>2</span></a></li>
		
			<li><a href="/tags/Git/">Git<span>2</span></a></li>
		
			<li><a href="/tags/TakeDown/">TakeDown<span>4</span></a></li>
		
			<li><a href="/tags/struts2/">struts2<span>1</span></a></li>
		
			<li><a href="/tags/Mysql/">Mysql<span>9</span></a></li>
		
			<li><a href="/tags/多线程/">多线程<span>4</span></a></li>
		
			<li><a href="/tags/NetWorker/">NetWorker<span>2</span></a></li>
		
			<li><a href="/tags/Web/">Web<span>3</span></a></li>
		
			<li><a href="/tags/Servlet/">Servlet<span>2</span></a></li>
		
			<li><a href="/tags/动态代理/">动态代理<span>4</span></a></li>
		
			<li><a href="/tags/V2ray/">V2ray<span>1</span></a></li>
		
			<li><a href="/tags/Spring/">Spring<span>5</span></a></li>
		
			<li><a href="/tags/Maven/">Maven<span>1</span></a></li>
		
			<li><a href="/tags/JVM/">JVM<span>1</span></a></li>
		
			<li><a href="/tags/Raspberry/">Raspberry<span>1</span></a></li>
		
			<li><a href="/tags/Exception/">Exception<span>1</span></a></li>
		
			<li><a href="/tags/RabbitMQ/">RabbitMQ<span>1</span></a></li>
		
			<li><a href="/tags/Hibernate/">Hibernate<span>2</span></a></li>
		
			<li><a href="/tags/Redis/">Redis<span>4</span></a></li>
		
		
		   <li><a href="/tags">...<span>25</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/archives/6e1b8bba.html"  title="上手树莓派，打算将弃用的笔记本硬盘挂在树莓派主机上，作为下载机使用,由于旧硬盘是win电脑拆下来的硬盘，磁盘格式为`Microsoft basic data`..." ><i class="fa fa-file-o"></i>Linux下挂载移动硬盘(ntfs格式)</a>
      </li>
    
      <li>
        <a href="/archives/27e17559.html"  title="redis总的所有数据默认保存在内存当中的.但场景需要，有时候需要进行持久化保存" ><i class="fa fa-file-o"></i>Redis持久化方案</a>
      </li>
    
      <li>
        <a href="/archives/3eac123.html"  title="当一个系统访问量上来的时候，不只是数据库性能瓶颈问题了，数据库数据安全也会浮现，这时候合理使用数据库锁机制就显得异常重要了。" ><i class="fa fa-file-o"></i>数据库锁机制分类</a>
      </li>
    
      <li>
        <a href="/archives/7ffea1fe.html"  title="RabbitMQ消息作为分布式消息协同工具，承担者协同各个系统之间的正常通信。如何确保消息通过RabbitMQ传输而不丢失数据？" ><i class="fa fa-file-o"></i>RabbitMQ消息可靠性</a>
      </li>
    
      <li>
        <a href="/archives/28d7adef.html"  title="快速失败：当在迭代一个集合的时候，如果有另外一个线程在修改这个集合，就会抛出ConcurrentModification异常，java.util下都是快速失败。 安全失败：在迭代时候会在集合二层做一个拷贝，所以在修改集合上层元素不会影响下层。在java.util.concurrent下都是安全失败" ><i class="fa fa-file-o"></i>快速失败与安全失败机制</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="http://www.github.com/RicoNut" title="My Github account." target="_blank"]);">RicoNut Github</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->




    </div>
  </div>
  <div class="container-narrow">
    <footer> <p>
  &copy; 2019 Rico Nut
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
  </div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>


<!-- syntax highlighting -->


</body>
</html>